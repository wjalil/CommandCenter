<form method="post" action="/admin/shifts/create" class="border rounded shadow-sm p-3 bg-white mb-4">
  <input type="hidden" name="tenant_id" value="{{ request.state.tenant_id }}">
  <h5 class="mb-3">➕ Create New Shift</h5>

  {% if preset_labels %}
  <div class="mb-2">
    <label class="form-label">Preset Labels</label>
    <div class="d-flex flex-wrap gap-2">
        {% for label in preset_labels %}
        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setLabel(`{{ label | e }}`)">
            {{ label }}
        </button>
        {% endfor %}
    </div>
  </div>
  {% endif %}

  <div class="row g-2 align-items-center mb-3">
    <!-- Label Input -->
    <div class="col-md-3">
      <input type="text" class="form-control" name="label" id="labelInput" placeholder="Shift Label" required>
    </div>

    <!-- Date Picker -->
    <div class="col-md-2">
      <input type="date" class="form-control" name="date" id="dateInput" required>
    </div>

    <!-- Start Time Dropdown (name= start_time) -->
    <div class="col-md-2">
      <select class="form-select" name="start_time" id="startTime" required>
        <option value="">Start Time</option>
        {% for hour in range(6, 24) %}
          {% for minute in [0, 30] %}
            {% set time_24 = "%02d:%02d"|format(hour, minute) %}
            {% set suffix = "AM" if hour < 12 else "PM" %}
            {% set hour_12 = (hour - 1) % 12 + 1 %}
            {% set time_display = "%d:%02d %s"|format(hour_12, minute, suffix) %}
            <option value="{{ date }}T{{ time_24 }}">{{ time_display }}</option>
          {% endfor %}
        {% endfor %}
      </select>
    </div>

    <!-- End Time Dropdown (name= end_time) -->
    <div class="col-md-2">
      <select class="form-select" name="end_time" id="endTime" required>
        <option value="">End Time</option>
        {% for hour in range(6, 24) %}
          {% for minute in [0, 30] %}
            {% set time_24 = "%02d:%02d"|format(hour, minute) %}
            {% set suffix = "AM" if hour < 12 else "PM" %}
            {% set hour_12 = (hour - 1) % 12 + 1 %}
            {% set time_display = "%d:%02d %s"|format(hour_12, minute, suffix) %}
            <option value="{{ date }}T{{ time_24 }}">{{ time_display }}</option>
          {% endfor %}
        {% endfor %}
      </select>
    </div>

    <!-- Recurring -->
    <div class="col-md-2 form-check mt-2">
      <input class="form-check-input" type="checkbox" name="is_recurring" value="true" id="recurringCheck">
      <label class="form-check-label" for="recurringCheck">Recurring</label>
    </div>

    <!-- Shift Type Dropdown -->
    <div class="col-md-2">
      <select class="form-select" name="shift_type" required>
        <option value="">Shift Type</option>
        <option value="Store">Store</option>
        <option value="Driver">Driver</option>
      </select>
    </div>

    <!-- Submit -->
    <div class="col-md-1 mt-2">
      <button type="submit" class="btn btn-primary">➕ Add</button>
    </div>
  </div>
</form>

<script>
  function setLabel(value) {
    document.getElementById('labelInput').value = value;
  }

  // Auto-fill today's date and update dropdown values accordingly
  const dateInput = document.getElementById('dateInput');
  const today = new Date().toISOString().split('T')[0];
  dateInput.value = today;

  dateInput.addEventListener("change", function() {
    const newDate = this.value;
    const startSelect = document.getElementById("startTime");
    const endSelect = document.getElementById("endTime");

    for (const option of startSelect.options) {
      if (option.value.includes("T")) {
        const time = option.value.split("T")[1];
        option.value = `${newDate}T${time}`;
      }
    }

    for (const option of endSelect.options) {
      if (option.value.includes("T")) {
        const time = option.value.split("T")[1];
        option.value = `${newDate}T${time}`;
      }
    }
  });

  // Trigger once on load
  dateInput.dispatchEvent(new Event("change"));
</script>
