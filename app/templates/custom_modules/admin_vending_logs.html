{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

<div class="container mt-3 mb-2 text-end">
  <a href="/admin/dashboard" class="btn btn-sm btn-outline-secondary">üè† Home</a>
</div>

  <h4>üßä Submit Vending Machine Log</h4>
  <form method="post" enctype="multipart/form-data" class="mb-5">
  <div class="mb-3">
    <label for="machine_id" class="form-label">Machine Location</label>
    <select name="machine_id" class="form-select" required>
        <option disabled selected value="">Select a machine</option>
        {% for machine in machines %}
        <option value="{{ machine.id }}">{{ machine.name }}</option>
        {% endfor %}
    </select>
    </div>

    <div class="mb-3">
      <label for="notes" class="form-label">Notes</label>
      <textarea name="notes" class="form-control" rows="2" placeholder="E.g. Grab Pelligrino, restock Kit-Kats"></textarea>
    </div>
    <div class="mb-3">
        <label for="photos" class="form-label">Photos (Snack + Bev)</label>
        <input type="file" name="photos" class="form-control" multiple>
    </div>
    <button type="submit" class="btn btn-primary">Submit Log</button>
  </form>

  <h4>üìú Past Logs</h4>
  {% for log in logs %}
    <div class="card mb-3">
      <div class="card-body">
        <p><strong>Submitted by:</strong> {{ log.submitter.name if log.submitter else 'Unknown' }}</p>
        <p><strong>Location:</strong> {{ log.machine.name if log.machine else '‚Äî' }}</p><p><strong>üìç Machine:</strong> 
          <h5 class="mb-2 text-primary-emphasis border-start border-4 ps-3">
            {{ log.machine.name if log.machine else '‚Äî' }}
          </h5>
        </p><p><strong>Notes:</strong> {{ log.notes or '‚Äî' }}</p>
        {% if log.photo_filename %}
            {% for filename in log.photo_filename.split(",") %}
                <img src="/static/vending_logs/{{ filename }}" class="img-fluid rounded mb-2 me-2" style="max-width: 200px;">
            {% endfor %}
        {% endif %}
        <p class="text-muted mt-2">{{ log.timestamp.strftime('%b %d, %Y %I:%M %p') }}</p>
      </div>
    </div>
  {% endfor %}

</div>
{% endblock %}