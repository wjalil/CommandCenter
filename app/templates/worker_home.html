<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="refresh" content="300" />
  <title>Worker ¬∑ Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root{
      --bg1:#f7f9fc; --bg2:#eef3f9; --ink:#22283a;
      --brand:#0d6efd; --brand-soft:#e8f0ff; --ok:#16a34a; --warn:#ef4444;
      --card-shadow:0 6px 18px rgba(0,0,0,.06);
      --card-shadow-hover:0 12px 28px rgba(0,0,0,.10);
      --radius:16px; --radius-lg:20px;
    }
    body{
      background: radial-gradient(1200px 600px at 20% -10%, var(--bg2), transparent 60%),
                  linear-gradient(to bottom, var(--bg1), #e9eef6 60%, #e7ecf4);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      color: var(--ink);
      padding-bottom: 3rem;
    }

    /* Navbar */
    .navbar{
      background: #fff;
      border-bottom: 1px solid rgba(13,110,253,.08);
      box-shadow: 0 2px 10px rgba(0,0,0,.04);
    }
    .navbar-brand{
      font-weight: 800; font-size: 1.25rem; color: var(--brand)!important;
      letter-spacing:.2px;
    }

    /* Top strip with clock + quick status */
    .hero-strip{
      background: linear-gradient(135deg, #ffffff, var(--brand-soft));
      border: 1px solid rgba(13,110,253,.08);
      border-left: 6px solid var(--brand);
      border-radius: var(--radius-lg);
      box-shadow: var(--card-shadow);
      padding: 1.1rem 1.25rem;
    }
    .clock-meta{ font-size:.9rem; color:#6b7280 }

    /* Card grid */
    .quick-actions .card{
      border: 1px solid rgba(2,6,23,.06);
      border-radius: var(--radius);
      box-shadow: var(--card-shadow);
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      height: 100%;
      overflow: hidden;
    }
    .quick-actions .card:hover{
      transform: translateY(-2px);
      box-shadow: var(--card-shadow-hover);
      border-color: rgba(13,110,253,.2);
    }

    /* Icon bubble + text align */
    .qa-body{
      display:flex; gap:.9rem; align-items:flex-start;
      min-height: 90px;
    }
    .qa-ico{
      width:42px; height:42px; border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      background:#f3f6ff; font-size:1.25rem; line-height:1;
      flex:0 0 42px;
    }
    .qa-text h5{
      font-size:1.05rem; margin:0 0 .15rem 0; font-weight:700;
      letter-spacing:.1px;
    }
    .qa-text p{ margin:0; color:#6b7280; font-size:.9rem }

    /* Buttons */
    .btn{ border-radius: 10px; transition: transform .18s ease, box-shadow .18s ease; }
    .btn:hover{ transform: translateY(-1px) }
    .btn-lg{ padding:.65rem 1.1rem; }

    /* Micro badges */
    .chip{
      display:inline-flex; align-items:center; gap:.4rem;
      background:#f4f6fb; color:#2b2f42; border:1px solid rgba(2,6,23,.06);
      border-radius:999px; padding:.25rem .6rem; font-size:.8rem; font-weight:600;
    }
    .chip.ok{ background:#ecfdf5; color:#065f46; border-color:#a7f3d0 }
    .chip.out{ background:#fef2f2; color:#991b1b; border-color:#fecaca }

    /* Utilities */
    .section-title{ font-weight:800; letter-spacing:.2px }
    .tight{ max-width: 1150px }
    @media (max-width: 575.98px){
      .btn-lg{ padding:.55rem .95rem; }
      .qa-body{ min-height: auto; }
    }
  </style>
</head>
<body>

<!-- Header -->
<nav class="navbar navbar-expand-lg px-3 mb-4">
  <div class="container-fluid tight d-flex justify-content-between align-items-center">
    <span class="navbar-brand">üëã Welcome, {{ worker_name }}</span>
    <div class="d-flex gap-2">
      <a href="/logout" class="btn btn-outline-danger btn-sm">üîì Logout</a>
    </div>
  </div>
</nav>

<div class="container tight">

  <!-- ‚è± Clock / Shift strip -->
  <div class="hero-strip mb-4">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
      <div>
        {% if open_entry %}
          <div class="fw-bold">‚úÖ On the clock ‚Äî started at
            {% set est_time = open_entry.clock_in.astimezone(pytz.timezone('America/New_York')) %}
            <span id="clockInTime">{{ est_time.strftime('%I:%M %p') }}</span>
          </div>
          <div class="clock-meta">
            Elapsed: <span id="elapsed" data-start="{{ open_entry.clock_in.isoformat() }}Z">--:--:--</span>
            <span class="ms-2 chip ok">Active</span>
          </div>
        {% else %}
          <div class="fw-bold">‚è± You are currently clocked out.</div>
          <div class="clock-meta">
            Tap ‚ÄúClock In‚Äù to start your shift timer
            <span class="ms-2 chip out">Off shift</span>
          </div>
        {% endif %}
      </div>

      <div class="d-flex gap-2">
        {% if open_entry %}
          <form id="clockOutForm" method="post" action="/worker/clock-out">
            <button class="btn btn-danger btn-lg">Clock Out</button>
          </form>
        {% else %}
          <form id="clockInForm" method="post" action="/worker/clock-in">
            {% if default_shift_id %}
              <input type="hidden" name="shift_id" value="{{ default_shift_id }}" />
            {% endif %}
            <button class="btn btn-primary btn-lg">Clock In</button>
          </form>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- ‚ö° Quick Actions (aligned grid) -->
  <div class="d-flex align-items-center justify-content-between mb-2">
    <h5 class="section-title m-0">Quick Actions</h5>
  </div>

  <div class="quick-actions row g-3">
    <!-- Today‚Äôs Task Board -->
    <div class="col-12 col-sm-6 col-lg-3">
      <a href="/worker/taskboard" class="text-decoration-none text-dark">
        <div class="card h-100">
          <div class="card-body qa-body">
            <div class="qa-ico">üìã</div>
            <div class="qa-text">
              <h5>Today‚Äôs Task Board</h5>
              <p>Check off your assigned tasks</p>
            </div>
          </div>
        </div>
      </a>
    </div>

    <!-- View Schedule -->
    <div class="col-12 col-sm-6 col-lg-3">
      <a href="/worker/shifts" class="text-decoration-none text-dark">
        <div class="card h-100">
          <div class="card-body qa-body">
            <div class="qa-ico">üóìÔ∏è</div>
            <div class="qa-text">
              <h5>View Schedule</h5>
              <p>See all your assigned shifts</p>
            </div>
          </div>
        </div>
      </a>
    </div>

    <!-- Report Missing Items (Shopping) -->
    <div class="col-12 col-sm-6 col-lg-3">
      <a href="/shopping/items" class="text-decoration-none text-dark">
        <div class="card h-100">
          <div class="card-body qa-body">
            <div class="qa-ico">üì¶</div>
            <div class="qa-text">
              <h5>Report Missing Items</h5>
              <p>Open the shopping module</p>
            </div>
          </div>
        </div>
      </a>
    </div>

    <!-- Recipes / SOPs -->
    <div class="col-12 col-sm-6 col-lg-3">
      <a href="/documents/worker/documents" class="text-decoration-none text-dark">
        <div class="card h-100">
          <div class="card-body qa-body">
            <div class="qa-ico">üìÑ</div>
            <div class="qa-text">
              <h5>View Recipes</h5>
              <p>Recipes & SOP repository</p>
            </div>
          </div>
        </div>
      </a>
    </div>

    <!-- Driver Log -->
    <div class="col-12 col-sm-6 col-lg-3">
      <a href="/modules/driver_order" class="text-decoration-none text-dark">
        <div class="card h-100">
          <div class="card-body qa-body">
            <div class="qa-ico">üìù</div>
            <div class="qa-text">
              <h5>Driver Log</h5>
              <p>Submit delivery notes & photo</p>
            </div>
          </div>
        </div>
      </a>
    </div>

  </div><!-- /quick-actions -->

</div><!-- /container -->

<script>
  // Intercept clock forms to POST via fetch and reload on success
  function hookAjax(formId){
    const f = document.getElementById(formId);
    if(!f) return;
    f.addEventListener('submit', async (e) => {
      e.preventDefault();
      const resp = await fetch(f.action, { method:'POST', body: new FormData(f) });
      if (resp.ok) window.location.reload();
    });
  }
  hookAjax('clockInForm');
  hookAjax('clockOutForm');

  // Live elapsed timer from ISO start
  (function(){
    const el = document.getElementById('elapsed');
    if (!el) return;
    const startISO = el.getAttribute('data-start');
    const startedAt = startISO ? new Date(startISO) : null;
    if (!startedAt) return;

    function pad(n){ return n.toString().padStart(2,'0'); }
    function tick(){
      const diff = Math.max(0, (Date.now() - startedAt.getTime()) / 1000);
      const h = Math.floor(diff/3600);
      const m = Math.floor((diff%3600)/60);
      const s = Math.floor(diff%60);
      el.textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
    }
    tick();
    setInterval(tick, 1000);
  })();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
