<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="refresh" content="300" />
  <title>Worker ¬∑ Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root{
      --bg-base: #f8fafc;
      --bg-card: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --accent-purple: #8b5cf6;
      --accent-blue: #3b82f6;
      --accent-teal: #14b8a6;
      --accent-pink: #ec4899;
      --accent-amber: #f59e0b;
      --accent-emerald: #10b981;
    }
    
    body{
      background: linear-gradient(135deg, #f1f5f9 0%, #e0e7ff 100%);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: var(--text-primary);
      padding-bottom: 3rem;
      min-height: 100vh;
      position: relative;
    }

    /* Subtle animated gradient overlay */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(59, 130, 246, 0.08) 0%, transparent 50%);
      animation: subtleShift 20s ease infinite alternate;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes subtleShift {
      0% { opacity: 0.4; }
      100% { opacity: 0.7; }
    }

    /* Navbar - Refined glass */
    .navbar{
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
      position: relative;
      z-index: 10;
    }
    
    .navbar-brand{
      font-weight: 700; 
      font-size: 1.3rem; 
      color: var(--text-primary) !important;
      letter-spacing: -0.3px;
    }

    .container.tight {
      max-width: 1200px;
      position: relative;
      z-index: 1;
    }

    /* Hero Clock Strip - Elegant glass */
    .hero-strip{
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
      padding: 1.75rem 2rem;
      position: relative;
      overflow: hidden;
    }
    
    .hero-strip::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.05), transparent);
      animation: slideShine 8s ease-in-out infinite;
    }

    @keyframes slideShine {
      0%, 100% { left: -100%; }
      50% { left: 100%; }
    }

    .clock-meta{ 
      font-size: 0.95rem; 
      color: var(--text-secondary);
    }

    /* Section Title */
    .section-title{ 
      font-weight: 700; 
      letter-spacing: -0.3px;
      color: var(--text-primary);
      font-size: 1.4rem;
    }

    /* Card Grid - Refined and elegant */
    .quick-actions .card{
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 18px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      height: 100%;
      overflow: hidden;
      position: relative;
    }

    /* Subtle gradient accent on left edge */
    .quick-actions .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      opacity: 0.8;
      transition: opacity 0.3s ease;
    }

    .card-taskboard::before { background: linear-gradient(180deg, var(--accent-purple), var(--accent-blue)); }
    .card-schedule::before { background: linear-gradient(180deg, var(--accent-pink), var(--accent-purple)); }
    .card-orders::before { background: linear-gradient(180deg, var(--accent-blue), var(--accent-teal)); }
    .card-shopping::before { background: linear-gradient(180deg, var(--accent-emerald), var(--accent-teal)); }
    .card-recipes::before { background: linear-gradient(180deg, var(--accent-amber), var(--accent-pink)); }
    .card-driver::before { background: linear-gradient(180deg, var(--accent-teal), var(--accent-blue)); }

    .quick-actions .card:hover{
      transform: translateY(-4px);
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.12);
      border-color: rgba(148, 163, 184, 0.3);
    }

    .quick-actions .card:hover::before {
      opacity: 1;
      width: 5px;
    }

    /* Icon bubble - Clean and minimal */
    .qa-body{
      display: flex; 
      gap: 1rem; 
      align-items: flex-start;
      min-height: 90px;
      position: relative;
      z-index: 1;
    }
    
    .qa-ico{
      width: 52px; 
      height: 52px; 
      border-radius: 14px;
      display: flex; 
      align-items: center; 
      justify-content: center;
      background: rgba(139, 92, 246, 0.1);
      font-size: 1.6rem; 
      line-height: 1;
      flex: 0 0 52px;
      border: 1px solid rgba(139, 92, 246, 0.2);
      transition: all 0.3s ease;
    }

    .quick-actions .card:hover .qa-ico {
      background: rgba(139, 92, 246, 0.15);
      transform: scale(1.05);
    }
    
    .qa-text h5{
      font-size: 1.1rem; 
      margin: 0 0 0.25rem 0; 
      font-weight: 700;
      letter-spacing: -0.2px;
      color: var(--text-primary);
    }
    
    .qa-text p{ 
      margin: 0; 
      color: var(--text-secondary); 
      font-size: 0.9rem;
      line-height: 1.5;
    }

    /* Buttons - Refined */
    .btn{ 
      border-radius: 12px; 
      transition: all 0.3s ease;
      font-weight: 600;
      letter-spacing: -0.1px;
    }
    
    .btn:hover{ 
      transform: translateY(-2px);
    }
    
    .btn-lg{ 
      padding: 0.85rem 1.8rem;
      font-size: 1.05rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
      border: none;
      color: white;
      box-shadow: 0 4px 16px rgba(139, 92, 246, 0.3);
    }

    .btn-primary:hover {
      box-shadow: 0 6px 24px rgba(139, 92, 246, 0.4);
      background: linear-gradient(135deg, #9d6ffb, #4f90f7);
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--accent-pink), #ef4444);
      border: none;
      color: white;
      box-shadow: 0 4px 16px rgba(236, 72, 153, 0.3);
    }

    .btn-danger:hover {
      box-shadow: 0 6px 24px rgba(236, 72, 153, 0.4);
      background: linear-gradient(135deg, #f260a7, #f87171);
    }

    .btn-outline-danger {
      border: 1.5px solid rgba(239, 68, 68, 0.3);
      color: #ef4444;
      background: rgba(239, 68, 68, 0.05);
      backdrop-filter: blur(10px);
    }

    .btn-outline-danger:hover {
      background: rgba(236, 72, 153, 0.1);
      border-color: var(--accent-pink);
      color: #ec4899;
    }

    /* Badges - Refined chips */
    .chip{
      display: inline-flex; 
      align-items: center; 
      gap: 0.5rem;
      border-radius: 999px; 
      padding: 0.4rem 0.9rem; 
      font-size: 0.85rem; 
      font-weight: 600;
      letter-spacing: -0.1px;
      border: 1px solid;
    }
    
    .chip.ok{ 
      background: rgba(16, 185, 129, 0.1);
      color: #059669;
      border-color: rgba(16, 185, 129, 0.3);
    }
    
    .chip.out{ 
      background: rgba(245, 158, 11, 0.1);
      color: #d97706;
      border-color: rgba(245, 158, 11, 0.3);
    }

    /* Responsive */
    @media (max-width: 575.98px){
      .btn-lg{ padding: 0.7rem 1.4rem; }
      .qa-body{ min-height: auto; }
      .qa-ico { width: 48px; height: 48px; font-size: 1.45rem; }
      .hero-strip { padding: 1.4rem 1.5rem; }
    }
  </style>
</head>
<body>

<!-- Header -->
<nav class="navbar navbar-expand-lg px-3 mb-4">
  <div class="container-fluid tight d-flex justify-content-between align-items-center">
    <span class="navbar-brand">üëã Welcome, {{ worker_name }}</span>
    <div class="d-flex gap-2">
      <a href="/logout" class="btn btn-outline-danger btn-sm">üîì Logout</a>
    </div>
  </div>
</nav>

<div class="container tight">

  <!-- ‚è± Clock / Shift strip -->
  <div class="hero-strip mb-4">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
      <div style="position: relative; z-index: 1;">
        {% if open_entry %}
          <div class="fw-bold" style="font-size: 1.15rem; color: var(--text-primary);">
            ‚úÖ On the clock ‚Äî started at
            {% set est_time = open_entry.clock_in.astimezone(pytz.timezone('America/New_York')) %}
            <span id="clockInTime">{{ est_time.strftime('%I:%M %p') }}</span>
          </div>
          <div class="clock-meta mt-1">
            Elapsed: <span id="elapsed" data-start="{{ open_entry.clock_in.isoformat() }}Z" style="font-weight: 700; font-size: 1.05rem; color: var(--text-primary);">--:--:--</span>
            <span class="ms-2 chip ok">Active</span>
          </div>
        {% else %}
          <div class="fw-bold" style="font-size: 1.15rem; color: var(--text-primary);">‚è± You are currently clocked out.</div>
          <div class="clock-meta mt-1">
            Tap "Clock In" to start your shift timer
            <span class="ms-2 chip out">Off shift</span>
          </div>
        {% endif %}
      </div>

      <div class="d-flex gap-2" style="position: relative; z-index: 1;">
        {% if open_entry %}
          <form id="clockOutForm" method="post" action="/worker/clock-out">
            <button class="btn btn-danger btn-lg">Clock Out</button>
          </form>
        {% else %}
          <form id="clockInForm" method="post" action="/worker/clock-in">
            {% if default_shift_id %}
              <input type="hidden" name="shift_id" value="{{ default_shift_id }}" />
            {% endif %}
            <button class="btn btn-primary btn-lg">Clock In</button>
          </form>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- ‚ö° Quick Actions -->
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h5 class="section-title m-0">Quick Actions</h5>
  </div>

  <div class="quick-actions row g-4">
    <!-- Today's Task Board -->
    <div class="col-12 col-sm-6 col-lg-4">
      <a href="/worker/taskboard" class="text-decoration-none">
        <div class="card card-taskboard h-100">
          <div class="card-body qa-body">
            <div class="qa-ico">üìã</div>
            <div class="qa-text">
              <h5>Today's Task Board</h5>
              <p>Check off your assigned tasks</p>
            </div>
          </div>
        </div>
      </a>
    </div>

    <!-- View Schedule -->
    <div class="col-12 col-sm-6 col-lg-4">
      <a href="/worker/shifts" class="text-decoration-none">
        <div class="card card-schedule h-100">
          <div class="card-body qa-body">
            <div class="qa-ico">üóìÔ∏è</div>
            <div class="qa-text">
              <h5>View Schedule</h5>
              <p>See all your assigned shifts</p>
            </div>
          </div>
        </div>
      </a>
    </div>

    <!-- Orders -->
    <div class="col-12 col-sm-6 col-lg-4">
      <a href="/worker/orders" class="text-decoration-none">
        <div class="card card-orders h-100">
          <div class="card-body qa-body">
            <div class="qa-ico">üõí</div>
            <div class="qa-text">
              <h5>View Orders</h5>
              <p>Check customer orders</p>
            </div>
          </div>
        </div>
      </a>
    </div>

    <!-- Report Missing Items -->
    <div class="col-12 col-sm-6 col-lg-4">
      <a href="/shopping/items" class="text-decoration-none">
        <div class="card card-shopping h-100">
          <div class="card-body qa-body">
            <div class="qa-ico">üì¶</div>
            <div class="qa-text">
              <h5>Report Missing Items</h5>
              <p>Open the shopping module</p>
            </div>
          </div>
        </div>
      </a>
    </div>

    <!-- Recipes / SOPs -->
    <div class="col-12 col-sm-6 col-lg-4">
      <a href="/documents/worker/documents" class="text-decoration-none">
        <div class="card card-recipes h-100">
          <div class="card-body qa-body">
            <div class="qa-ico">üìÑ</div>
            <div class="qa-text">
              <h5>View Recipes</h5>
              <p>Recipes & SOP repository</p>
            </div>
          </div>
        </div>
      </a>
    </div>

    <!-- Driver Log -->
    <div class="col-12 col-sm-6 col-lg-4">
      <a href="/modules/driver_order" class="text-decoration-none">
        <div class="card card-driver h-100">
          <div class="card-body qa-body">
            <div class="qa-ico">üìù</div>
            <div class="qa-text">
              <h5>Driver Log</h5>
              <p>Submit delivery notes & photo</p>
            </div>
          </div>
        </div>
      </a>
    </div>

  </div><!-- /quick-actions -->

</div><!-- /container -->

<script>
  // Intercept clock forms to POST via fetch and reload on success
  function hookAjax(formId){
    const f = document.getElementById(formId);
    if(!f) return;
    f.addEventListener('submit', async (e) => {
      e.preventDefault();
      const resp = await fetch(f.action, { method:'POST', body: new FormData(f) });
      if (resp.ok) window.location.reload();
    });
  }
  hookAjax('clockInForm');
  hookAjax('clockOutForm');

  // Live elapsed timer from ISO start
  (function(){
    const el = document.getElementById('elapsed');
    if (!el) return;
    const startISO = el.getAttribute('data-start');
    const startedAt = startISO ? new Date(startISO) : null;
    if (!startedAt) return;

    function pad(n){ return n.toString().padStart(2,'0'); }
    function tick(){
      const diff = Math.max(0, (Date.now() - startedAt.getTime()) / 1000);
      const h = Math.floor(diff/3600);
      const m = Math.floor((diff%3600)/60);
      const s = Math.floor(diff%60);
      el.textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
    }
    tick();
    setInterval(tick, 1000);
  })();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>