{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

  <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <div>
      <h2 class="mb-0">‚úèÔ∏è Edit Menu</h2>
      <div class="text-muted small">Update menu details and manage categories</div>
    </div>
    <div class="d-flex gap-2">
      <a href="/admin/menus" class="btn btn-outline-secondary">‚Üê Back</a>

      <form method="post" action="/admin/menus/{{ menu.id }}/delete" onsubmit="return confirm('Delete this menu AND all its items? This cannot be undone.');">
        <button class="btn btn-outline-danger" type="submit">üóëÔ∏è Delete Menu</button>
      </form>
    </div>
  </div>

  {% if request.query_params.get("success") %}
    <div class="alert alert-success">{{ request.query_params.get("success") }}</div>
  {% endif %}
  {% if request.query_params.get("error") %}
    <div class="alert alert-danger">{{ request.query_params.get("error") }}</div>
  {% endif %}

  <div class="card shadow-sm">
    <div class="card-body">

      <form method="post" action="/admin/menus/{{ menu.id }}/edit">

        <div class="row g-3">
          <div class="col-md-5">
            <label class="form-label">Menu Name</label>
            <input class="form-control" name="name" value="{{ menu.name }}" required>
          </div>

          <div class="col-md-5">
            <label class="form-label">Description</label>
            <input class="form-control" name="description" value="{{ menu.description or '' }}">
          </div>

          <div class="col-md-2 d-flex align-items-end">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="is_active" name="is_active" {% if menu.is_active %}checked{% endif %}>
              <label class="form-check-label" for="is_active">Set Active</label>
            </div>
          </div>
        </div>

        <hr class="my-4">

        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">Categories</h5>
          <div class="text-muted small">Uncheck a category to deactivate it.</div>
        </div>

        <div class="table-responsive">
          <table class="table table-bordered align-middle">
            <thead class="table-light">
              <tr>
                <th style="width: 70px;">Active</th>
                <th>Name</th>
                <th style="width: 140px;">Order</th>
              </tr>
            </thead>
            <tbody>
              {% for c in categories %}
                <tr>
                  <td class="text-center">
                    <input type="hidden" name="category_ids" value="{{ c.id }}">
                    <input class="form-check-input" type="checkbox" name="category_active" value="{{ c.id }}" {% if c.is_active %}checked{% endif %}>
                  </td>
                  <td>
                    <input class="form-control" name="category_names" value="{{ c.name }}">
                  </td>
                  <td>
                    <input class="form-control" name="category_orders" type="number" value="{{ c.display_order or 0 }}">
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="mt-3">
          <h6 class="mb-2">Add new categories</h6>

          <div class="row g-2" x-data="{ rows: [] }">
            <template x-for="(r, i) in rows" :key="i">
              <div class="col-12">
                <div class="d-flex gap-2">
                  <input class="form-control" name="new_category_names" placeholder="Category name">
                  <input class="form-control" style="width:140px;" name="new_category_orders" type="number" placeholder="Order">
                  <button class="btn btn-outline-danger" type="button" @click="rows.splice(i,1)">‚úï</button>
                </div>
              </div>
            </template>

            <div class="col-12">
              <button type="button" class="btn btn-outline-secondary" @click="rows.push({})">+ Add Category</button>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-end mt-4">
          <button class="btn btn-primary" type="submit">Save Changes</button>
        </div>

      </form>
    </div>
  </div>
</div>
{% endblock %}
